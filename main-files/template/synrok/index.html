<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Synrok - Mobile HTML Template</title>

    <!-- Plugins -->
    <link rel="stylesheet" type="text/css" href="assets/plugins/metismenu/metisMenu.min.css" />
    <link rel="stylesheet" type="text/css" href="assets/plugins/metismenu/mm-vertical.css" />
    
    <!--CSS Files-->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.3/font/bootstrap-icons.css">
    <link href="assets/css/style.css" rel="stylesheet"/>
    <link href="assets/css/dark-theme.css" rel="stylesheet"/>
  </head>
  <body>

    <!--page loader-->
    <div class="loader-wrapper">
      <div class="d-flex justify-content-center align-items-center position-absolute top-50 start-50 translate-middle">
        <div class="spinner-border text-white" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>
    </div>
   <!--end loader-->

   <!--start wrapper-->
    <div class="wrapper">

      <!--start to page content-->
       <div class="page-content">

        <div class="card rounded-0 border-0">
          <div class="card-body p-0">
             <div class="text-center">
              <img class="img-fluid" src="assets/images/splash-screen-1.webp" alt=""/> 
             </div>

             <div class="text-center my-4">
               <h5 class="text-dark fw-bold">We Promis Productivity</h5>
               <p class="mb-0">At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis</p>
             </div>
             <div class="d-grid">
                <a href="authentication-splash-2.html" class="btn btn-dark btn-ecomm rounded-3">Get Started</a>   
             </div>
          </div>
        </div>

        <!-- Add form for selecting models and entering API keys -->
        <div class="card rounded-0 border-0 mt-4">
          <div class="card-body p-0">
            <form id="model-selection-form" method="POST" action="/generate">
              <div class="mb-3">
                <label for="idea" class="form-label">Idea</label>
                <input type="text" class="form-control" id="idea" name="idea" required>
              </div>
              <div class="mb-3">
                <label for="llm" class="form-label">Select Model</label>
                <select class="form-select" id="llm" name="llm" required>
                  <option value="claude">Claude 3.5</option>
                  <option value="sonnet">Sonnet</option>
                  <option value="deepseek">Deep Seek</option>
                </select>
              </div>
              <div class="mb-3">
                <label for="api_key" class="form-label">API Key</label>
                <input type="text" class="form-control" id="api_key" name="api_key" required>
              </div>
              <div class="d-grid">
                <button type="submit" class="btn btn-dark btn-ecomm rounded-3">Generate</button>
              </div>
            </form>
          </div>
        </div>

        <!-- Add conversation log section -->
        <div class="card rounded-0 border-0 mt-4">
          <div class="card-body p-0">
            <h5 class="text-dark fw-bold">Conversation Log</h5>
            <div id="conversation-log" class="conversation-log" style="max-height: 300px; overflow-y: auto;">
              <!-- Conversation messages will be appended here -->
            </div>
          </div>
        </div>

        <!-- Add chat interface section -->
        <div class="card rounded-0 border-0 mt-4">
          <div class="card-body p-0">
            <h5 class="text-dark fw-bold">Chat Interface</h5>
            <div id="chat-interface" class="chat-interface" style="max-height: 300px; overflow-y: auto;">
              <!-- Chat messages will be appended here -->
            </div>
            <div class="input-group mt-3">
              <input type="text" class="form-control" id="chat-input" placeholder="Type a message...">
              <button class="btn btn-dark" id="send-chat">Send</button>
            </div>
          </div>
        </div>

        <!-- Add collapsible conversation sections -->
        <div class="card rounded-0 border-0 mt-4">
          <div class="card-body p-0">
            <h5 class="text-dark fw-bold">Collapsible Conversation Sections</h5>
            <div id="collapsible-sections" class="accordion" style="max-height: 300px; overflow-y: auto;">
              <!-- Collapsible sections will be appended here -->
            </div>
          </div>
        </div>

       </div>
     <!--end to page content-->

    </div>
   <!--end wrapper-->


    <!--JS Files-->  
    <script src="assets/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/cookies-theme-switcher.js"></script>

    <script src="assets/js/loader.js"></script>
   
    <!-- Add script to handle conversation log display -->
    <script>
      document.getElementById('model-selection-form').addEventListener('submit', function(event) {
        event.preventDefault();
        const formData = new FormData(this);
        fetch('/generate', {
          method: 'POST',
          body: formData
        })
        .then(response => response.json())
        .then(data => {
          const conversationLog = document.getElementById('conversation-log');
          conversationLog.innerHTML = '';
          data.conversation_log.forEach(log => {
            const logEntry = document.createElement('div');
            logEntry.classList.add('log-entry');
            logEntry.innerHTML = `<strong>${log.agent} (${log.role})</strong> [${log.timestamp}]: ${log.message}`;
            conversationLog.appendChild(logEntry);
          });

          // Update chat interface
          const chatInterface = document.getElementById('chat-interface');
          chatInterface.innerHTML = '';
          data.conversation_log.forEach(log => {
            const chatMessage = document.createElement('div');
            chatMessage.classList.add('chat-message');
            chatMessage.innerHTML = `<strong>${log.agent} (${log.role})</strong>: ${log.message}`;
            chatInterface.appendChild(chatMessage);
          });

          // Update collapsible sections
          const collapsibleSections = document.getElementById('collapsible-sections');
          collapsibleSections.innerHTML = '';
          const tasks = {};
          data.conversation_log.forEach(log => {
            if (!tasks[log.task]) {
              tasks[log.task] = [];
            }
            tasks[log.task].push(log);
          });
          Object.keys(tasks).forEach(task => {
            const section = document.createElement('div');
            section.classList.add('accordion-item');
            section.innerHTML = `
              <h2 class="accordion-header" id="heading-${task}">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-${task}" aria-expanded="true" aria-controls="collapse-${task}">
                  ${task}
                </button>
              </h2>
              <div id="collapse-${task}" class="accordion-collapse collapse show" aria-labelledby="heading-${task}" data-bs-parent="#collapsible-sections">
                <div class="accordion-body">
                  ${tasks[task].map(log => `<strong>${log.agent} (${log.role})</strong>: ${log.message}`).join('<br>')}
                </div>
              </div>
            `;
            collapsibleSections.appendChild(section);
          });
        })
        .catch(error => console.error('Error:', error));
      });

      // Handle chat input
      document.getElementById('send-chat').addEventListener('click', function() {
        const chatInput = document.getElementById('chat-input');
        const message = chatInput.value;
        if (message.trim() !== '') {
          const chatInterface = document.getElementById('chat-interface');
          const chatMessage = document.createElement('div');
          chatMessage.classList.add('chat-message');
          chatMessage.innerHTML = `<strong>User</strong>: ${message}`;
          chatInterface.appendChild(chatMessage);
          chatInput.value = '';
        }
      });
    </script>

  </body>
</html>
